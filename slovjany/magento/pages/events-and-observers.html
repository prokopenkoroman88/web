<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Events and Observers</title>
	<link rel="stylesheet" href="../css/style.css">
</head>
<body>


<a href="https://devdocs.magento.com/guides/v2.4/extension-dev-guide/events-and-observers.html">Оригинал</a>
<a href="https://devdocs.magento.com/guides/v2.4/ext-best-practices/extension-coding/observers-bp.html">Оригинал</a>




<div class="h1"><div class="en">Events and observers</div><div class="ru">События и наблюдатели</div></div><div class="p"><div class="en">Overview</div><div class="ru">Обзор</div></div><div class="p"><div class="en">Working with events and observers is one of the main ways to extend Magento functionality. The events and observers implementation in Magento 2 is based on the publish-subscribe pattern. Using events and observers, you can run your custom code in response to a specific Magento event or even a custom event.</div><div class="ru">Работа с событиями и наблюдателями - один из основных способов расширить функциональность Magento. Реализация событий и наблюдателей в Magento 2 основана на шаблоне публикации-подписки. Используя события и наблюдателей, вы можете запускать собственный код в ответ на конкретное событие Magento или даже на настраиваемое событие.</div></div><div class="h2"><div class="en">Events</div><div class="ru">События</div></div><div class="p"><div class="en">Events are dispatched by modules when certain actions are triggered. In addition to its own events, Magento allows you to create your own events that can be dispatched in your code. When an event is dispatched, it can pass data to any observers configured to watch that event.</div><div class="ru">События отправляются модулями при запуске определенных действий. В дополнение к собственным событиям Magento позволяет вам создавать свои собственные события, которые можно отправлять в вашем коде. Когда событие отправляется, оно может передавать данные любым наблюдателям, настроенным для наблюдения за этим событием.</div></div><div class="h2"><div class="en">Dispatching events</div><div class="ru">Отправка событий</div></div><div class="p"><div class="en">Events can be dispatched using the Magento\Framework\Event\ManagerInterface class. This class can be obtained through dependency injection by defining the dependency in your constructor.</div><div class="ru">События можно отправлять с помощью класса Magento\Framework\Event\ManagerInterface. Этот класс можно получить путем внедрения зависимостей, определив зависимость в вашем конструкторе.</div></div><div class="h2"><div class="en">To dispatch an event, call the dispatch function of the event manager class and provide it with the name of the event you want to dispatch along with an array of data you wish to provide to observers.</div><div class="ru">Чтобы отправить событие, вызовите функцию отправки класса диспетчера событий и предоставьте ей имя события, которое вы хотите отправить, вместе с массивом данных, которые вы хотите предоставить наблюдателям.</div></div><div class="h2"><div class="en">The following example shows you how to dispatch an event with and without an array of data.</div><div class="ru">В следующем примере показано, как отправить событие с массивом данных и без него.</div></div>



<code class="code-php">
namespace MyCompany\MyModule;

use Magento\Framework\Event\ManagerInterface as EventManager;

class MyClass
{
  /**
   * @var EventManager
   */
  private $eventManager;

  /*
   * @param \Magento\Framework\Event\ManagerInterface as EventManager
   */
  public function __construct(EventManager $eventManager)
  {
    $this->eventManager = $eventManager;
  }

  public function something()
  {
    $eventData = null;
    // Code...
    $this->eventManager->dispatch('my_module_event_before');
    // More code that sets $eventData...
    $this->eventManager->dispatch('my_module_event_after', ['myEventData' => $eventData]);
  }
}
</code>


<div class="h2"><div class="en">Creating new events</div><div class="ru">Создание новых событий</div></div>
<div class="p"><div class="en">Custom events can be dispatched by simply passing in a unique event name to the event manager when you call the dispatch function. Your unique event name is referenced in your module’s events.xml file where you specify which observers will react to that event.</div><div class="ru">Пользовательские события можно отправлять, просто передав уникальное имя события диспетчеру событий при вызове функции диспетчеризации. На ваше уникальное имя события есть ссылка в файле events.xml вашего модуля, где вы указываете, какие наблюдатели будут реагировать на это событие.</div></div>
<div class="p"><div class="en">You can make the custom event my_module_event_after subscribable by declaring the MyCompany/MyModule/etc/events.xml file as follows:</div><div class="ru">Вы можете сделать настраиваемое событие my_module_event_after доступным для подписки, объявив файл MyCompany/MyModule/etc/events.xml следующим образом:</div></div>


<code class="code-xml">
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:Event/etc/events.xsd">
    <event name="my_module_event_after">
        <observer name="my_module_event_after_observer" instance="MyCompany\MyModule\Observer\MyEvent"/>
    </event>
</config>
</code>




<div class="h2"><div class="en">Event areas</div><div class="ru">Площадки для мероприятий</div></div>
<div class="p"><div class="en">Generally, the location of the events.xml file will be under the <module-root>/etc directory. Observers that are associated with events here will watch for these events globally. The events.xml file can also be defined under the <module-root>/etc/frontend and <module-root>/etc/adminhtml directories to configure observers to only watch for events in those specific areas.</module-root></module-root></module-root></div><div class="ru">Как правило, файл events.xml находится в каталоге <module-root>/etc. Наблюдатели, связанные с происходящими здесь событиями, будут наблюдать за этими событиями во всем мире. Файл events.xml также можно определить в каталогах <module-root>/etc/frontend и <module-root>/etc/adminhtml, чтобы настроить наблюдателей на наблюдение только за событиями в этих конкретных областях.</module-root></module-root></module-root></div></div>
<div class="p"><div class="en">Declare the observer in the appropriate area. The global area allows the observer to run in all areas (adminhtml, crontab, frontend, graphql, webapi_rest, webapi_soap).</div><div class="ru">Объявите наблюдателя в соответствующей зоне. Глобальная область позволяет наблюдателю работать во всех областях (adminhtml, crontab, frontend, graphql, webapi_rest, webapi_soap).</div></div>

<table>
  <thead>
    <tr>
      <th>Area</th>
      <th>File location</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">global</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/events.xml</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">adminhtml</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/adminhtml/events.xml</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">crontab</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/crontab/events.xml</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">frontend</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/frontend/events.xml</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">graphql</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/graphql/events.xml</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">webapi_rest</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/webapi_rest/events.xml</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">webapi_soap</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/webapi_soap/events.xml</code></td>
    </tr>
  </tbody>
</table>


<div class="h2"><div class="en">Observers</div><div class="ru">Наблюдатели</div></div>
<div class="p"><div class="en">Observers are a certain type of Magento class that can influence general behavior, performance, or change business logic. Observers are executed whenever the event they are configured to watch is dispatched by the event manager.</div><div class="ru">Наблюдатели - это определенный тип класса Magento, который может влиять на общее поведение, производительность или изменять бизнес-логику. Наблюдатели выполняются всякий раз, когда событие, на которое они настроены наблюдать, отправляется диспетчером событий.</div></div>
<div class="h2"><div class="en">Creating an observer</div><div class="ru">Создание наблюдателя</div></div>
<div class="p"><div class="en">To create an observer, you must place your class file under your <module-root>/Observer directory. Your observer class should implement Magento\Framework\Event\ObserverInterface and define its execute function.</module-root></div><div class="ru">Чтобы создать наблюдателя, вы должны поместить файл класса в каталог <module-root>/Observer. Ваш класс наблюдателя должен реализовать Magento\Framework\Event\ObserverInterface и определить его функцию выполнения.</module-root></div></div>
<div class="h2"><div class="en">Below is an example of the basic observer class structure:</div><div class="ru">Ниже приведен пример базовой структуры класса наблюдателя:</div></div>



<code class="code-php">
namespace MyCompany\MyModule\Observer;

use Magento\Framework\Event\ObserverInterface;

class MyObserver implements ObserverInterface
{
  public function __construct()
  {
    // Observer initialization code...
    // You can use dependency injection to get any class this observer may need.
  }

  public function execute(\Magento\Framework\Event\Observer $observer)
  {
    // Observer execution code...
  }
}
</code>


<div class="p"><div class="en">One of the more powerful feature of observers is that they are able to use parameters passed into the event when it was dispatched. Below is an example of an observer obtaining data passed in when the event was dispatched.</div><div class="ru">Одна из наиболее мощных функций наблюдателей - то, что они могут использовать параметры, переданные в событие, когда оно было отправлено. Ниже приведен пример получения данных наблюдателем, переданных при отправке события.</div></div>

<code class="code-php">
namespace MyCompany\MyModule\Observer;

use Magento\Framework\Event\ObserverInterface;

class AnotherObserver implements ObserverInterface
{
  public function __construct()
  {
    // Observer initialization code...
    // You can use dependency injection to get any class this observer may need.
  }

  public function execute(\Magento\Framework\Event\Observer $observer)
  {
    $myEventData = $observer->getData('myEventData');
    // Additional observer execution code...
  }
}
</code>


<div class="h2"><div class="en">Subscribing to events</div><div class="ru">Подписка на события</div></div>
<div class="p"><div class="en">Observers can be configured to watch certain events in the events.xml file.</div><div class="ru">Наблюдатели могут быть настроены для наблюдения за определенными событиями в файле events.xml.</div></div>
<div class="h2"><div class="en">The observer xml element has the following properties:</div><div class="ru">Элемент xml наблюдателя имеет следующие свойства:</div></div>
<div class="p"><div class="en">name (required) - The name of the observer for the event definition.</div><div class="ru">name (обязательно) - имя наблюдателя для определения события.</div></div>
<div class="p"><div class="en">instance (required) - The fully qualified class name of the observer.</div><div class="ru">instance (обязательно) - полное имя класса наблюдателя.</div></div>
<div class="p"><div class="en">disabled - Determines whether this observer is active or not. Default value is false.</div><div class="ru">disabled - определяет, активен ли этот наблюдатель. Значение по умолчанию - false.</div></div>
<div class="p"><div class="en">shared - Determines the lifestyle of the class. Default is true.</div><div class="ru">shared - определяет образ жизни класса. По умолчанию верно.</div></div>
<div class="p"><div class="en">The observer name must be unique, or an override will occur.</div><div class="ru">Имя наблюдателя должно быть уникальным, иначе произойдет переопределение.</div></div>
<div class="p"><div class="en">Below is an example of how to assign observers to watch certain events:</div><div class="ru">Ниже приведен пример того, как назначить наблюдателей для наблюдения за определенными событиями:</div></div>

<code class="code-xml">
<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:Event/etc/events.xsd">
    <event name="my_module_event_before">
        <observer name="myObserverName" instance="MyCompany\MyModule\Observer\MyObserver" />
    </event>
    <event name="my_module_event_after">
        <observer name="myObserverName" instance="MyCompany\MyModule\Observer\AnotherObserver" />
    </event>
</config>

</code>

<div class="p"><div class="en">In the preceding example, we assign the observer MyObserver to the custom event my_module_event_before and AnotherObserver to my_module_event_after.</div><div class="ru">В предыдущем примере мы назначаем наблюдателя MyObserver настраиваемому событию my_module_event_before, а AnotherObserver - my_module_event_after.</div></div>
<div class="p"><div class="en">Observer names must be unique per event definition. This means that you cannot have two observers with the same name in the same event definition. In the example, both observers have the name myObserverName. This is acceptable because each of those observers belong to different event definitions.</div><div class="ru">Имена наблюдателей должны быть уникальными для каждого определения события. Это означает, что у вас не может быть двух наблюдателей с одинаковыми именами в одном определении события. В этом примере оба наблюдателя имеют имя myObserverName. Это приемлемо, потому что каждый из этих наблюдателей принадлежит к разным определениям событий.</div></div>
<div class="p"><div class="en">If you declare an observer with a name that is already in use within the same event, Magento merges these declaration nodes into a single observer declaration, respecting the module load order as defined in the app/etc/config.php file. This is useful when disabling an observer declared in another module.</div><div class="ru">Если вы объявляете наблюдателя с именем, которое уже используется в том же событии, Magento объединяет эти узлы объявления в одно объявление наблюдателя, соблюдая порядок загрузки модуля, как определено в файле app/etc/config.php. Это полезно при отключении наблюдателя, объявленного в другом модуле.</div></div>
<div class="h2"><div class="en">Disabling an observer</div><div class="ru">Отключение наблюдателя</div></div>
<div class="p"><div class="en">Existing observers can be disabled, if you do not want to have them running. It is a good practice to disable the obsever if you want to change its logic rather than override it. Below is an example of how to disable the previously created observer.</div><div class="ru">Существующие наблюдатели могут быть отключены, если вы не хотите, чтобы они работали. Рекомендуется отключить наблюдателя, если вы хотите изменить его логику, а не отменять ее. Ниже приведен пример того, как отключить ранее созданный наблюдатель.</div></div>


<code class="code-xml">
<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:Event/etc/events.xsd">
    <event name="my_module_event_before">
        <observer name="myObserverName" disabled="true" />
    </event>
</config>
</code>

<hr>


<div class="h2"><div class="en">Observers Best Practices</div><div class="ru">Рекомендации наблюдателей</div></div>
<div class="p"><div class="en">Overview</div><div class="ru">Обзор</div></div>
<div class="p"><div class="en">Observers are capable of modifying the behavior of a Magento application because they are dynamically injected into the execution flow. Poorly designed and coded observers can cause issues, instabilities, or otherwise break the application.</div><div class="ru">Наблюдатели могут изменять поведение приложения Magento, потому что они динамически вводятся в поток выполнения. Плохо спроектированные и закодированные наблюдатели могут вызвать проблемы, нестабильность или иным образом нарушить работу приложения.</div></div>
<div class="p"><div class="en">We encourage you to follow these best practices aimed towards reducing problems when your observer is executed.</div><div class="ru">Мы рекомендуем вам следовать этим передовым методам, направленным на уменьшение проблем при запуске вашего наблюдателя.</div></div>
<div class="h2"><div class="en">Best practices</div><div class="ru">Лучшие практики</div></div>
<div class="p"><div class="en">Make your observer efficient</div><div class="ru">Сделайте вашего наблюдателя эффективным</div></div>
<div class="p"><div class="en">Try to keep your observer small and efficient by avoiding complex computations, if possible. This is especially important when your observer is listening to an event that is frequently dispatched. Having complex computations in your observer can slow down application processes.</div><div class="ru">Старайтесь, чтобы ваш наблюдатель был маленьким и эффективным, по возможности избегая сложных вычислений. Это особенно важно, когда ваш наблюдатель прослушивает часто отправляемое событие. Выполнение сложных вычислений в вашем наблюдателе может замедлить процессы приложения.</div></div>
<div class="p"><div class="en">Do not include business logic</div><div class="ru">Не включать бизнес-логику</div></div>
<div class="p"><div class="en">Your observer should not contain logic other than what is needed for it to run. Business logic should be encapsulated in other classes that your observer uses.</div><div class="ru">Ваш наблюдатель не должен содержать никакой другой логики, кроме той, которая необходима для его работы. Бизнес-логика должна быть инкапсулирована в другие классы, которые использует ваш наблюдатель.</div></div>
<div class="p"><div class="en">Declare observer in the appropriate scope</div><div class="ru">Объявить наблюдателя в соответствующей области</div></div>
<div class="p"><div class="en">Make your observer as specific as it needs to be. Declare your observer in the appropriate area:</div><div class="ru">Сделайте своего наблюдателя настолько конкретным, насколько это необходимо. Объявите своего наблюдателя в соответствующей зоне:</div></div>


<table>
  <thead>
    <tr>
      <th>Area</th>
      <th>File location</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">global</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/events.xml</code></td>
      <td>Observer will be executed in all areas: <code class="language-plaintext highlighter-rouge">adminhtml</code>, <code class="language-plaintext highlighter-rouge">crontab</code>, <code class="language-plaintext highlighter-rouge">frontend</code>, <code class="language-plaintext highlighter-rouge">graphql</code>, <code class="language-plaintext highlighter-rouge">webapi_rest</code>, <code class="language-plaintext highlighter-rouge">webapi_soap</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">adminhtml</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/adminhtml/events.xml</code></td>
      <td>Observer will be executed in the <code class="language-plaintext highlighter-rouge">adminhtml</code> area only.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">crontab</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/crontab/events.xml</code></td>
      <td>Observer will be executed in the <code class="language-plaintext highlighter-rouge">crontab</code> area only.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">frontend</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/frontend/events.xml</code></td>
      <td>Observer will be executed in the <code class="language-plaintext highlighter-rouge">frontend</code> area only.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">graphql</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/graphql/events.xml</code></td>
      <td>Observer will be executed in the <code class="language-plaintext highlighter-rouge">graphql</code> area only.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">webapi_rest</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/webapi_rest/events.xml</code></td>
      <td>Observer will be executed in the <code class="language-plaintext highlighter-rouge">webapi_rest</code> area only.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">webapi_soap</code></td>
      <td><code class="language-plaintext highlighter-rouge">&lt;module-dir&gt;/etc/webapi_soap/events.xml</code></td>
      <td>Observer will be executed in the <code class="language-plaintext highlighter-rouge">webapi_soap</code> area only.</td>
    </tr>
  </tbody>
</table>


<div class="h2"><div class="en">It is NOT RECOMMENDED to register everything in the global area, as the bootstrapping process will become much heavier. For example, the application must run and process additional checks for your observer.</div><div class="ru">НЕ РЕКОМЕНДУЕТСЯ регистрировать все в глобальной области, так как процесс начальной загрузки станет намного тяжелее. Например, приложение должно запускать и обрабатывать дополнительные проверки для вашего наблюдателя.</div></div>
<div class="p"><div class="en">Avoid cyclical event loops</div><div class="ru">Избегайте циклических циклов событий</div></div>
<div class="p"><div class="en">Cyclical event loops occur when your observer calls the method of an object that dispatches an event that triggers a chain of events that ends up dispatching that same initial event that executes your observer in a recurring manner. Make sure your observer is not dispatching an event that it immediately listens to or will listen to in the chain of events that follows.</div><div class="ru">Циклические циклы событий возникают, когда ваш наблюдатель вызывает метод объекта, который отправляет событие, которое запускает цепочку событий, которая в конечном итоге отправляет то же самое начальное событие, которое выполняет ваш наблюдатель повторяющимся образом. Убедитесь, что ваш наблюдатель не отправляет событие, которое он немедленно прослушивает или будет прослушивать в следующей цепочке событий.</div></div>
<div class="p"><div class="en">Do not rely on invocation order</div><div class="ru">Не полагайтесь на порядок вызова</div></div>
<div class="p"><div class="en">Your observer should not make assumptions about the order in which it will be invoked nor should it rely on the execution of another observer. Observers listening to the same event may be invoked in any order when that event is dispatched.</div><div class="ru">Ваш наблюдатель не должен делать предположений о порядке, в котором он будет вызываться, и не должен полагаться на выполнение другого наблюдателя. Наблюдатели, прослушивающие одно и то же событие, могут быть вызваны в любом порядке при отправке этого события.</div></div>



<!--
<code class="code-php">


</code>
-->


	<script src="../js/script.js"></script>
</body>
</html>