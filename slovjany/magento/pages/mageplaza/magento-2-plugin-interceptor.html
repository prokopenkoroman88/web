<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Плагин Magento 2 - Перехватчик</title>
	<link rel="stylesheet" href="../../css/style.css">
</head>
<body>

<!--
<h1 class="h1">
	<div class="en">
		
	</div>
	<div class="ru">
		
	</div>
</h1>


<div class="p">
	<div class="en">
		
	</div>
	<div class="ru">
		
	</div>
</div>



<h2 class="h2">
	<div class="en">
		
	</div>
	<div class="ru">
		
	</div>
</h2>

<div class="p">
	<div class="en">
		
	</div>
	<div class="ru">
		
	</div>
</div>


-->

<a href="https://www.mageplaza.com/magento-2-module-development/magento-2-plugin-interceptor.html">Оригинал</a>
<!--
<h1 class="h1">
	<div class="en">
		A Module in Magento 2
	</div>
	<div class="ru">
		Модули в Magento 2
	</div>
</h1>
-->


<div class="h1"><div class="en">Magento 2 Plugin - Interceptor</div><div class="ru">Плагин Magento 2 - Перехватчик</div></div>
<div class="p"><div class="en">Magento 2 Plugin is a technical plugin for your better writing code. Interception Plugin is referred to a little magento 2 extension that allows editing the behavior of any public class or method by intercepting a function call and running code either before or after or around the function call. By using this Magento 2 Plugin Interception, you can modify the behavior of a class while there is no need to change the class directly.</div><div class="ru">Плагин Magento 2 - это технический плагин для лучшего написания кода. Плагин перехвата относится к небольшому расширению magento 2, которое позволяет редактировать поведение любого общедоступного класса или метода, перехватывая вызов функции и выполняя код либо до, либо после, либо вокруг вызова функции. Используя этот перехват плагина Magento 2, вы можете изменить поведение класса, при этом нет необходимости изменять класс напрямую.</div></div>
<div class="h2"><div class="en">Table of contents</div><div class="ru">Оглавление</div></div>




<!--
<ul>
<li>Benefits of Magento 2 Plugin</a></li>
<li>Magento 2 plugin’s restriction</a></li>
<li>Guide for creating Magento 2 new plugin</a>
<ul>
<li>Declaring a plugin in Magento 2</a></li>
<li>Explainations</a></li>
<li>Defining a plugin in Magento 2</a></li>
<li>Before methods</a></li>
<li>After methods</a></li>
<li>Around methods</a></li>
<li>Check the result</a></li>
</ul>
</li>
<li>Set priority for plugins</a></li>
<li>Magento 2 plugin example</a></li>
</ul>
-->

<div class="p"><div class="en"><a href="#benefits-magento-2-plugin">Benefits of Magento 2 Plugin</a></div><div class="ru"><a href="#benefits-magento-2-plugin">Преимущества плагина Magento 2</a></div></div>
<div class="p"><div class="en"><a href="#magento-2-plugins-restriction">Magento 2 plugin’s restriction</a></div><div class="ru"><a href="#magento-2-plugins-restriction">Ограничение плагина Magento 2</a></div></div>
<div class="p"><div class="en"><a href="#guide-for-creating-magento-2-new-plugin">Guide for creating Magento 2 new plugin</a></div><div class="ru"><a href="#guide-for-creating-magento-2-new-plugin">Руководство по созданию нового плагина для Magento 2</a></div></div>
<div class="p"><div class="en"><a href="#declaring-a-plugin-in-magento-2">Declaring a plugin in Magento 2</a></div><div class="ru"><a href="#declaring-a-plugin-in-magento-2">Объявление плагина в Magento 2</a></div></div>
<div class="p"><div class="en"><a href="#explainations">Explainations</a></div><div class="ru"><a href="#explainations">Объяснения</a></div></div>
<div class="p"><div class="en"><a href="#defining-a-plugin-in-magento-2">Defining a plugin in Magento 2</a></div><div class="ru"><a href="#defining-a-plugin-in-magento-2">Определение плагина в Magento 2</a></div></div>
<div class="p"><div class="en"><a href="#before-methods">Before methods</a></div><div class="ru"><a href="#before-methods">До методов</a></div></div>
<div class="p"><div class="en"><a href="#after-methods">After methods</a></div><div class="ru"><a href="#after-methods">После методов</a></div></div>
<div class="p"><div class="en"><a href="#around-methods">Around methods</a></div><div class="ru"><a href="#around-methods">Вокруг методы</a></div></div>
<div class="p"><div class="en"><a href="#check-the-result">Check the result</a></div><div class="ru"><a href="#check-the-result">Проверить результат</a></div></div>
<div class="p"><div class="en"><a href="#set-priority-for-plugins">Set priority for plugins</a></div><div class="ru"><a href="#set-priority-for-plugins">Установить приоритет для плагинов</a></div></div>
<div class="p"><div class="en"><a href="#magento-2-plugin-example">Magento 2 plugin example</a></div><div class="ru"><a href="#magento-2-plugin-example">Пример плагина Magento 2</a></div></div>

<div class="p"><div class="en">Maybe you still think the observers can help you do that fluently but some differences need to be pointed out. Particularly, not only create functions of a class using dependency injection but Interception plugin can also be confirmed with a sortOrder, that allows checking the chain and order on which plugins run. That is the reason why this plugin doesn’t make the class change and doesn’t have any conflict with one another</div><div class="ru">Возможно, вы все еще думаете, что наблюдатели могут помочь вам в этом бегло, но следует указать на некоторые различия. В частности, не только создание функций класса с помощью внедрения зависимостей, но и подключаемый модуль перехвата также может быть подтвержден с помощью sortOrder, который позволяет проверять цепочку и порядок, в котором запускаются подключаемые модули. Вот почему этот плагин не меняет класс и не конфликтует друг с другом.</div></div>

<div class="h2"><div class="en">Benefits of Magento 2 Plugin</div><div class="ru">Преимущества плагина Magento 2</div></div>
<div class="p"><div class="en">For a module developer as you, Magento 2 Interception plugin allows:</div><div class="ru">Для такого разработчика модуля, как вы, плагин Magento 2 Interception позволяет:</div></div>
<div class="h2"><div class="en">Forwarding any method call that is used on an object manager controlled object and taken programmatic action</div><div class="ru">Перенаправление любого вызова метода, который используется для объекта, управляемого диспетчером объектов, и предпринятых программных действий</div></div>
<div class="p"><div class="en">Modifying the return value of any method call that is used on an object manager controlled object</div><div class="ru">Изменение возвращаемого значения любого вызова метода, который используется для объекта, управляемого диспетчером объектов</div></div>
<div class="p"><div class="en">Modifying the arguments of any method call that is used on an object manager controlled object</div><div class="ru">Изменение аргументов любого вызова метода, который используется для объекта, управляемого диспетчером объектов.</div></div>
<div class="p"><div class="en">Proceeding similarly when other modules are in progress of the same method in the same or predictable way.</div><div class="ru">Действуйте аналогично, когда другие модули выполняют тот же метод таким же или предсказуемым образом.</div></div>
<div class="p"><div class="en">If you have never had any experience in this way to create a system, it is not strange when you get confused with performance characteristics. But coming with the Mageplaza developer team who is confident in expert knowledge to know which software design patterns should be applied for this work. In this topic, maybe few of interceptor pattern will be given, so if you need to get more information or any problem not included in the scope of this post, please contact us.</div><div class="ru">Если у вас никогда не было опыта создания системы подобным образом, неудивительно, что вас путают с характеристиками производительности. Но вместе с командой разработчиков Mageplaza, которая уверена в своих экспертных знаниях, чтобы знать, какие шаблоны проектирования программного обеспечения следует применять для этой работы. В этой теме, возможно, будет приведено несколько паттернов перехватчиков, поэтому, если вам нужно получить дополнительную информацию или возникнут какие-либо проблемы, не упомянутые в этой публикации, свяжитесь с нами.</div></div>
<div class="h2"><div class="en">Magento 2 plugin’s restriction</div><div class="ru">Ограничение плагина Magento 2</div></div>
<div class="h2"><div class="en">What options Magento 2 Interception plugin doesn’t work with?</div><div class="ru">С какими опциями плагин Magento 2 Interception не работает?</div></div>
<div class="p"><div class="en">Objects that are instantiated before Magento\Framework\Interception is bootstrapped</div><div class="ru">Объекты, которые создаются до загрузки Magento\Framework\Interception</div></div>
<div class="p"><div class="en">Final methods</div><div class="ru">Окончательные методы</div></div>
<div class="p"><div class="en">Final classes</div><div class="ru">Заключительные занятия</div></div>
<div class="p"><div class="en">Any class that contains at least one final public method</div><div class="ru">Любой класс, содержащий хотя бы один окончательный общедоступный метод.</div></div>
<div class="p"><div class="en">Non-public methods</div><div class="ru">Непубличные методы</div></div>
<div class="p"><div class="en">Class methods (such as static methods)</div><div class="ru">Методы класса (например, статические методы)</div></div>
<div class="p"><div class="en">__construct</div><div class="ru">__construct</div></div>
<div class="p"><div class="en">Virtual types</div><div class="ru">Виртуальные типы</div></div>
<br>
<div class="h2"><div class="en">Guide for creating Magento 2 new plugin</div><div class="ru">Руководство по созданию нового плагина для Magento 2</div></div>
<div class="p"><div class="en">Declaring a plugin in Magento 2</div><div class="ru">Объявление плагина в Magento 2</div></div>

<code class="code-xml">
<config>
    <type name="{ObservedType}">
        <plugin name="{pluginName}" type="{PluginClassName}" sortOrder="1" disabled="false"/>
    </type>
</config>
</code>

<div class="h2"><div class="en">Explainations</div><div class="ru">Объяснения</div></div>
<div class="p"><div class="en">Required options</div><div class="ru">Обязательные параметры</div></div>
<div class="p"><div class="en">type name: Enter name of a class or interface that needs to be followed.</div><div class="ru">type name: введите имя класса или интерфейса, которому необходимо следовать.</div></div>
<div class="p"><div class="en">plugin name: An arbitrary plugin name that identifies a plugin. Also used to merge the configurations for the plugin.</div><div class="ru">Название плагина: произвольное имя плагина, которое идентифицирует плагин. Также используется для объединения конфигураций плагина.</div></div>
<div class="p"><div class="en">plugin type: Fill the name of a plugin’s class or its virtual type. You can refer the following naming convention for this field: \Vendor\Module\Plugin\&lt;ModelName&gt;Plugin.</div><div class="ru">тип плагина: введите имя класса плагина или его виртуального типа. Вы можете использовать следующее соглашение об именах для этого поля: \Vendor\Module\Plugin\&lt;ModelName&gt; Plugin.</div></div>
<div class="p"><div class="en">Optional options</div><div class="ru">Дополнительные опции</div></div>
<div class="p"><div class="en">plugin sortOrder: Set order when the plugin calls the other same methods in the process.</div><div class="ru">plugin sortOrder: установите порядок, когда плагин вызывает другие те же методы в процессе.</div></div>
<div class="p"><div class="en">plugin disabled: That allows you enable or disable a plugin quickly. As the default configuration, the chosen value is false. Use this property to disable core or third-party plugins in your di.xml file.</div><div class="ru">плагин отключен: позволяет быстро включать или отключать плагин. В качестве конфигурации по умолчанию выбрано значение false. Используйте это свойство, чтобы отключить основные или сторонние плагины в файле di.xml.</div></div>
<div class="p"><div class="en">As the following example, we will edit app\code\Mageplaza\HelloWorld\etc\di.xml, you need to insert the snippet:</div><div class="ru">В следующем примере мы отредактируем app\code\Mageplaza\HelloWorld\etc\di.xml, вам нужно вставить фрагмент:</div></div>



<code class="code-xml">
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../../../lib/internal/Magento/Framework/ObjectManager/etc/config.xsd">
    <type name="Mageplaza\HelloWorld\Controller\Index\Example">
        <plugin name="Mageplaza_HelloWorld_Plugin" type="Mageplaza\HelloWorld\Plugin\ExamplePlugin" sortOrder="10" disabled="false"  />
    </type>
</config>
</code>

<div class="p"><div class="en">For example, the following code define type name, we created Example.php file at app/code/Mageplaza/HelloWorld/Controller/Index/</div><div class="ru">Например, следующий код определяет имя типа, мы создали файл Example.php в app/code/Mageplaza/HelloWorld/Controller/Index/</div></div>
<div class="p"><div class="en">Contents would be:</div><div class="ru">Содержание будет: </div></div>


<code class="code-php">
< ?php

namespace Mageplaza\HelloWorld\Controller\Index;

class Example extends \Magento\Framework\App\Action\Action
{

	protected $title;

	public function execute()
	{
		echo $this->setTitle('Welcome');
		echo $this->getTitle();
	}

	public function setTitle($title)
	{
		return $this->title = $title;
	}

	public function getTitle()
	{
		return $this->title;
	}
}
</code>


<p>
With plugin name, we created Example.php file at app/code/Mageplaza/HelloWorld/Plugin/
</p>
<p>
Contents would be:
</p>


<code class="code-php">
< ?php

namespace Mageplaza\HelloWorld\Plugin;

class ExamplePlugin{

}
</code>


<div class="h2"><div class="en">Defining a plugin in Magento 2</div><div class="ru">Определение плагина в Magento 2</div></div>
<div class="p"><div class="en">A plugin is a great way to expand or edit a public method’s behavior by using code before, after or around method.</div><div class="ru">Плагин - отличный способ расширить или изменить поведение общедоступного метода, используя код до, после или вокруг метода.</div></div>
<div class="p"><div class="en">First of all, please get an object that provides permission to all public methods of the observed method’s class.</div><div class="ru">Прежде всего, получите объект, который предоставляет разрешение на все общедоступные методы класса наблюдаемого метода.</div></div>
<div class="h2"><div class="en">3 methods in Plugin</div><div class="ru">3 метода в плагине</div></div>
<div class="h2"><div class="en">before - beforeDispatch()</div><div class="ru">before - beforeDispatch ()</div></div>
<div class="p"><div class="en">around - aroundDispatch()</div><div class="ru">вокруг - aroundDispatch ()</div></div>
<div class="p"><div class="en">after - afterDispatch()</div><div class="ru">после - afterDispatch ()</div></div>
<div class="p"><div class="en">Before methods</div><div class="ru">До методов</div></div>
<div class="p"><div class="en">Before methods are the first methods to run in an observed method, and these methods must have the same name to the observed one’s name while the prefix label is before.</div><div class="ru">Прежде, чем методы являются первыми методами, запускаемыми в наблюдаемом методе, эти методы должны иметь то же имя, что и имя наблюдаемого, в то время как метка префикса находится перед.</div></div>
<div class="p"><div class="en">To apply the before methods for modifying the arguments of an observed method, you can return a modified argument. If there are multiple arguments, the returning will be carried out according to a range of those arguments. If the returning is invalid, that means the arguments for the observed method should not be modified.</div><div class="ru">Чтобы применить методы до изменения аргументов наблюдаемого метода, вы можете вернуть измененный аргумент. Если аргументов несколько, возврат будет выполнен в соответствии с диапазоном этих аргументов. Если возврат недействителен, это означает, что аргументы наблюдаемого метода не должны изменяться.</div></div>


<code class="code-php">
< ?php

namespace Mageplaza\HelloWorld\Plugin;

class ExamplePlugin
{

	public function beforeSetTitle(\Mageplaza\HelloWorld\Controller\Index\Example $subject, $title)
	{
		$title = $title . " to ";
		echo __METHOD__ . "</br>";

		return [$title];
	}

}
</code>


<div class="h2"><div class="en">After methods</div><div class="ru">После методов</div></div>
<div class="p"><div class="en">After methods start running right after the observed method is finished, and these methods must have the same name to the observed one’s name while the prefix label is “after”.</div><div class="ru">После запуска методов сразу после завершения наблюдаемого метода, и эти методы должны иметь то же имя, что и имя наблюдаемого, а метка префикса - «после».</div></div>
<div class="p"><div class="en">After methods take a responsibility of editing the results of an observed method in the correct way and being required to have a return value.</div><div class="ru">Методы After берут на себя ответственность за правильное редактирование результатов наблюдаемого метода и должны иметь возвращаемое значение.</div></div>





<code class="code-php">
< ?php

namespace Mageplaza\HelloWorld\Plugin;

class ExamplePlugin
{

	public function afterGetTitle(\Mageplaza\HelloWorld\Controller\Index\Example $subject, $result)
	{

		echo __METHOD__ . "</br>";

		return '<h1>'. $result . 'Mageplaza.com' .'</h1>';

	}

}
</code>

<div class="h2"><div class="en">Around methods</div><div class="ru">Вокруг методы</div></div>
<div class="p"><div class="en">Around methods allows the code to run before and after the observed method, so you can override a method. These methods must have the same name to the observed one’s name while the prefix label is “around”.</div><div class="ru">Метод Around позволяет коду запускаться до и после наблюдаемого метода, поэтому вы можете переопределить метод. Эти методы должны иметь то же имя, что и имя наблюдаемого, а метка префикса - «около».</div></div>
<div class="p"><div class="en">Before the arrange of the original method’s argument, a callable from around methods will be called to the next method in the chain, that means the next plugin or the observed function is also called.</div><div class="ru">Перед упорядочиванием аргумента исходного метода вызываемые извне методы будут вызываться для следующего метода в цепочке, что означает, что также вызывается следующий плагин или наблюдаемая функция.</div></div>
<div class="p"><div class="en">Note: In case the callable is not declared, the calling to neither the next plugin nor the original method is achieved.</div><div class="ru">Примечание. В случае, если вызываемый объект не объявлен, не выполняется вызов ни следующего плагина, ни исходного метода.</div></div>


<code class="code-php">
< ?php

namespace Mageplaza\HelloWorld\Plugin;

class ExamplePlugin
{


	public function aroundGetTitle(\Mageplaza\HelloWorld\Controller\Index\Example $subject, callable $proceed)
	{

		echo __METHOD__ . " - Before proceed() </br>";
		 $result = $proceed();
		echo __METHOD__ . " - After proceed() </br>";


		return $result;
	}

}
</code>

<p>
Check the result
</p>
<p>
All content of ExamplePlugin.php
</p>


<code class="code-php">
< ?php

namespace Mageplaza\HelloWorld\Plugin;

class ExamplePlugin
{

	public function beforeSetTitle(\Mageplaza\HelloWorld\Controller\Index\Example $subject, $title)
	{
		$title = $title . " to ";
		echo __METHOD__ . "</br>";

		return [$title];
	}


	public function afterGetTitle(\Mageplaza\HelloWorld\Controller\Index\Example $subject, $result)
	{

		echo __METHOD__ . "</br>";

		return '<h1>'. $result . 'Mageplaza.com' .'</h1>';

	}


	public function aroundGetTitle(\Mageplaza\HelloWorld\Controller\Index\Example $subject, callable $proceed)
	{

		echo __METHOD__ . " - Before proceed() </br>";
		 $result = $proceed();
		echo __METHOD__ . " - After proceed() </br>";


		return $result;
	}

}
</code>

<p>
After this, please clear the cache and check the result. It will show like this
</p>


<div class="img"><img src="https://cdn.mageplaza.com/media/general/O1vefUu.png" alt="magento 2 plugin"></div>


<div class="p"><div class="en">If your plugin is called by a method that matches with arguments, it must also match with them and simultaneously, you need to follow them carefully. During the process, please pay attention to the method’s original signature as well as the default parameters and the kind of suggestions.</div><div class="ru">Если ваш плагин вызывается методом, который соответствует аргументам, он также должен совпадать с ними, и одновременно вам необходимо внимательно им следовать. Во время процесса обращайте внимание на исходную подпись метода, а также на параметры по умолчанию и вид предложений.</div></div>
<div class="p"><div class="en">For example, applying the below code to identify a parameter of type SomeType which is nullable:</div><div class="ru">Например, применение приведенного ниже кода для идентификации параметра типа SomeType, допускающего значение NULL:</div></div>



<code class="code-php">
< ?php
namespace Mageplaza\HelloWorld\Model;

class MyUtility
{
    public function save(SomeType $obj = null)
    {
        //do something
    }
}
</code>

<p>
If you wrapped this method with a plugin like below:
</p>

<code class="code-php">
< ?php
namespace Mageplaza\HelloWorld\Plugin;

class MyUtilityPlugin
{
    public function aroundSave(\Mageplaza\HelloWorld\Model\MyUtility $subject, \callable $proceed, SomeType $obj)
    {
      //do something
    }
}
</code>

<div class="p"><div class="en">Note: Missing = Null</div><div class="ru">Примечание: отсутствует = ноль</div></div>
<div class="p"><div class="en">If you call the method together with null, PHP would make a fatal error because your plugin null is not allowed in your plugin. Besides, it is important to follow the arguments from the plugin that is called by the method. But if not concern the arguments, please use the variadics and argument unpacking to complete this:</div><div class="ru">Если вы вызовете метод вместе с null, PHP выдаст фатальную ошибку, потому что ваш плагин null не разрешен в вашем плагине. Кроме того, важно следовать аргументам плагина, вызываемого методом. Но если это не касается аргументов, используйте вариативные числа и распаковку аргументов, чтобы завершить это:</div></div>


<code class="code-php">
< ?php
namespace Mageplaza\HelloWorld\Plugin;

class MyUtilityPlugin
{
    public function aroundSave(\Mageplaza\HelloWorld\Model\MyUtility $subject, \callable $proceed, ...$args)
    {
      //do something
      $proceed(...$args);
    }
}
</code>

<div class="h2"><div class="en">Set priority for plugins</div><div class="ru">Установить приоритет для плагинов</div></div>
<div class="p"><div class="en">sortOrder option allow placing the plugins which are observing the same method in a queue. When before, after, or around methods start calling, the plugins are applied one by one.</div><div class="ru">Параметр sortOrder позволяет размещать в очереди плагины, которые наблюдают за одним и тем же методом. Когда до, после или около методов начинают вызывать, плагины применяются один за другим.</div></div>
<div class="h2"><div class="en">Magento 2 plugin example</div><div class="ru">Пример плагина Magento 2</div></div>

<p>Visit <a href="https://github.com/mageplaza/magento2-samples/tree/master/sample-module-interception">https://github.com/mageplaza/magento2-samples/tree/master/sample-module-interception</a></p>





<a href=".\.html">PREV</a>
<a href=".\.html">NEXT</a>

	<script src="../../js/script.js"></script>
</body>
</html>